
<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Bayesian Holonic (Global) Games | union&#39;s blog</title>
    <meta name="description"
        content="This past year I suffered a lot mentally and financially, my funding got paused and my girlfriend Sam (check out her spotify!) lost her boojee A.P.C. job. So I haven&rsquo;t posted for a while. It&rsquo;s really a leisure and effort to write stuff consistently (because wtf am I supposed to write?!!?). But the coding agents (Claude, Gemini etc..) really revolutionarized my efficiency, and shamelessly I have to admit that I use them a lot to &ldquo;vibe code&rdquo; and even do research, with sufficient human surveillance.
So hopefully, I will resume writing for my own sanity.">
    <link rel="canonical" href="https://unionpan.github.io/post/2025/mechanism_design/" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    
    <link rel="stylesheet" href="https://unionpan.github.io/scss/style.min.bdfc41214cc1a8cd1b66e75ea61094e5fc36501e8aa0c63d2662d1a318cc3668.css">
    <meta property="og:url" content="https://unionpan.github.io/post/2025/mechanism_design/">
  <meta property="og:site_name" content="union&#39;s blog">
  <meta property="og:title" content="Bayesian Holonic (Global) Games">
  <meta property="og:description" content="This past year I suffered a lot mentally and financially, my funding got paused and my girlfriend Sam (check out her spotify!) lost her boojee A.P.C. job. So I haven’t posted for a while. It’s really a leisure and effort to write stuff consistently (because wtf am I supposed to write?!!?). But the coding agents (Claude, Gemini etc..) really revolutionarized my efficiency, and shamelessly I have to admit that I use them a lot to “vibe code” and even do research, with sufficient human surveillance. So hopefully, I will resume writing for my own sanity.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-07-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-01T00:00:00+00:00">

    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Bayesian Holonic (Global) Games">
  <meta name="twitter:description" content="This past year I suffered a lot mentally and financially, my funding got paused and my girlfriend Sam (check out her spotify!) lost her boojee A.P.C. job. So I haven’t posted for a while. It’s really a leisure and effort to write stuff consistently (because wtf am I supposed to write?!!?). But the coding agents (Claude, Gemini etc..) really revolutionarized my efficiency, and shamelessly I have to admit that I use them a lot to “vibe code” and even do research, with sufficient human surveillance. So hopefully, I will resume writing for my own sanity.">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
    crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P8CZD2GL8F"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-P8CZD2GL8F');
    </script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
        });
    </script>
    
</head><body>
        <div class="theme-toggle-container">
            <a id="theme-toggle" class="theme-toggle" href="#">
                <img src="https://unionpan.github.io/svg/sun.svg" alt="sun icon" class="theme-icon" />
            </a>
        </div>
        
        
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>

        <div class="layout-container">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-content">
                    <div class="sidebar-header">
                        <h1 class="site-title">
                            <a href="/" class="site-title-link">YUNIAN PAN</a>
                        </h1>
                    </div>
                    <nav class="sidebar-nav">
                        <div class="nav-item-container">
                            <a href="#" class="nav-link blog-toggle active" onclick="toggleBlogMenu(event)">
                                Blog <span class="dropdown-arrow">▼</span>
                            </a>
                            <div class="submenu" id="blog-submenu">
                                <a href="/post/about_me" class="submenu-link">About Me</a>
                                <a href="/post/2022" class="submenu-link">2022</a>
                                <a href="/post/2023" class="submenu-link">2023</a>
                                <a href="/post/2024" class="submenu-link">2024</a>
                                <a href="/post/2025" class="submenu-link">2025</a>
                            </div>
                        </div>
                        <a href="/statement" class="nav-link ">Statement/CV</a>
                        <a href="/contact" class="nav-link ">Contact</a>
                        <a href="/photos" class="nav-link ">Photos</a>
                    </nav>
                    <div class="sidebar-footer">
                        <div class="copyright">
                            © 2022-2025 all rights reserved
                        </div>
                        <div class="social-icons">
                            
                            <a href="https://www.linkedin.com/in/unionpan/" title="Linkedin" class="social-link">
                                <svg height="32px" width="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
                            </a>
                            
                            <a href="https://github.com/UnionPan" title="Github" class="social-link">
                                <svg height="32px" width="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
                            </a>
                            
                            <a href="https://twitter.com/Union54572322" title="twitter" class="social-link">
                                <svg height="32px" width="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
                            </a>
                            
                            <a href="https://www.facebook.com/yunian.pan/" title="Facebook" class="social-link">
                                <svg height="32px" width="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg>
                            </a>
                            
                            <a href="https://www.instagram.com/pyn_rodcutter/?hl=en" title="instagram" class="social-link">
                                <svg height="32px" width="32px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
    <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
</svg>
                            </a>
                            
                        </div>
                    </div>
                </div>
            </aside>
            <main class="main-content">
<div class="single-container">
    <div class="archive">
        
        <div class="post-thumbnail-container">
            <img src="https://unionpan.github.io//images/post/2025/mechanism_design/thumbnail.jpg" alt="Bayesian Holonic (Global) Games" class="post-thumbnail-image">
        </div>
        
        <h1 class="title is-1">Bayesian Holonic (Global) Games</h1>
        <hr class="title-content-separator">
        
        <div class="title subtitle heading is-6">
            <div class="small-categories-container">
                
                        <a href="https://open.spotify.com/track/3xVtc7PB4V3AqAfq4Iahli?si=2f5b226464b74184">I am back</a>
                    
            </div>
        </div>
        
        <div class="content article-content">
            <div class="toc-container">
                
    <div class="post-toc">
        
            <aside>
                <button id="tocButton" ><h4 id="contents" style="margin-left: 1vw;color:rgb(96, 134, 180);margin-bottom: 0;">CONTENTS</h4></button>
                <div id="hide"><nav id="TableOfContents">
  <ul>
    <li><a href="#holonic-risk">&ldquo;Holonic Risk&rdquo;</a>
      <ul>
        <li><a href="#bayesian-equilibrium-analysis">Bayesian Equilibrium Analysis</a></li>
        <li><a href="#the-fixed-point-problem">The Fixed-Point Problem</a></li>
        <li><a href="#existence-and-uniqueness-of-equilibria">Existence and Uniqueness of Equilibria</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </aside>
        
    </div><script>
    
        let button = document.getElementById('tocButton');
        let hide = document.getElementById("hide");
        let contents=document.getElementById("contents");
        button.addEventListener("click", function() {
        if (hide.style.display!='block') {
            hide.style.display='block'
        } else {
            hide.style.display='none'
            contents.style.color='rgb(96, 134, 180)'
        }
        });
    




</script>
            </div>
            <p>This past year I suffered a lot mentally and financially, my funding got paused and my girlfriend Sam (check out her <a href="https://open.spotify.com/artist/3qo9BlnVduy6nW0pY1kmTQ">spotify</a>!) lost her boojee A.P.C. job. So I haven&rsquo;t posted for a while. It&rsquo;s really a leisure and effort to write stuff consistently (because wtf am I supposed to write?!!?). But the coding agents (Claude, Gemini etc..) really revolutionarized my efficiency, and shamelessly I have to admit that I use them a lot to &ldquo;vibe code&rdquo; and even do research, with sufficient human surveillance.
So hopefully, I will resume writing for my own sanity.</p>
<p>So I am a huge hypocrite&ndash;throughout the years I&rsquo;ve witnessed tons of people rebranding existing/trivial phenomenon/methodologies as &lsquo;&rsquo;novel frameworks&rsquo;&rsquo;. I mean, aren&rsquo;t we all? Even Shannon was just applying probability theory, except for it actually opened the pandora box. To some degree I believe being completely innovative is inherently <em>impossible</em> as you&rsquo;ve gotta find some shoulders to stand on. It gets harder when you&rsquo;re under constant pressure to publish, get grants, and do rebuttal with reviewers who might be having a bad day.</p>
<p>Sometimes I wonder where the objective bar, for what counts as &ldquo;innovative enough&rdquo;, actually is. The sheer volume of academic papers flood into the system, how much values do they actually create? Overworked reviewers delegate to grad students or (God help us) undergrads, are they able to catch when the emperor has no clothes?</p>
<h2 id="holonic-risk">&ldquo;Holonic Risk&rdquo;</h2>
<p>This is the paper my advisor has been writing. He gradually accustomed himself with ChatGPT that it just infiltrated to his everyday editing of stuff (the Overleaf history and code style shows it all,) which I can&rsquo;t say if it&rsquo;s good or bad. The core idea is that he envisioned this networked chunks of players that interact with each other through a set of specifically structured utility functions.
A &ldquo;holons&rdquo; is a &ldquo;chunk of players&rdquo;, and the Nash equilibrium, as you may upgrade it into Bayesian, is a &ldquo;Holonic equilibrium&rdquo;.</p>
<p>Here&rsquo;s a global game<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> example &ldquo;holonic Bayesian game&rdquo;:</p>
<p><strong>Players</strong>: Set of voters $N = \bigcup_{i \in I} N_i$ where $I$ indexes committees (holons) and $N_i$ are voters in committee $i$.</p>
<p><strong>Types</strong>: Each voter $k \in N_i$ has private type $\xi_k^i \in \{0,1\}$ drawn from Bernoulli$(p)$, representing their preference strength.</p>
<p><strong>Actions</strong>: Binary voting decision $x_k^i \in \{0,1\}$.</p>
<p><strong>Information Structure</strong>: Each voter observes only their own type $\xi_k^i$ but knows the type Bernoulli distribution $p$ is common across all voters.</p>
<p><strong>Payoff Structure</strong>: For voter $k$ in committee $i$, the utility function is:
$$
U_k^i(x_k^i, x_{-k}^i, \omega_{-i}; \xi_k^i) = \mathbf{1}_{{ \omega^i = 0}}(c_0 + c_1 x_k^i) + \mathbf{1}_{ { \omega^i = 1 } } c_2 \cdot \mathbf{1}_{ { x_k^i \neq \xi_k^i }}
$$</p>
<p>where $\omega^i \in {0,1}$ is the committee outcome and $\omega_{-i}$ represents other committees&rsquo; outcomes.</p>
<p>The &ldquo;holonic&rdquo; aspect reduces to this coupling mechanism:</p>
<p>$$ \omega^i = \mathbf{1}_{\left\{   \sum_{k \in N_i} x_k^i \geq \theta + \gamma \sum_{j \neq i} \omega^{j}\right\}}$$</p>
<p>So committee $i$ succeeds if its vote total exceeds a threshold that increases linearly with the number of failed external committees.
The parameter $\gamma \geq 0$ controls coupling strength.</p>
<p>To be fair this cannot be counted as completely a global game because it has atomic players. But the common feature is that you can sort of leverage the global symmetry to analyze the Nash equilibrium.</p>
<h3 id="bayesian-equilibrium-analysis">Bayesian Equilibrium Analysis</h3>
<p>In a Bayesian Nash equilibrium, each voter chooses a strategy $\sigma_k^i: \{0,1} \rightarrow \{0,1\}$ that maximizes expected utility given their beliefs about others&rsquo; strategies and external outcomes.</p>
<p><strong>Equilibrium condition</strong>: For truth-telling to be a Bayesian Nash equilibrium, we need basically:
$$
\mathbb{E}[U_k^i(\sigma^i_k(\xi_k^i), \sigma_{-k}^i(\xi_{-k}^i), \omega_{-i}; \xi_k^i)] \geq \mathbb{E}[U_k^i(1- \sigma^i_k(\xi_k^i), \sigma_{-k}^i(\xi_{-k}^i), \omega_{-i}; \xi_k^i)]
$$
for all $k, i$ and both values of $\xi_k^i$. So, you have $|\mathcal{I}|$ times $n$ set of equations for three types of strategies:</p>
<p><strong>Truth-telling strategy</strong>: $\sigma_k^i(\xi_k^i) = \xi_k^i$ (vote your type).</p>
<p><strong>Truth-reversing strategy</strong>: $\sigma_k^i(\xi_k^i) = 1 - \xi_k^i$ (vote against your type).</p>
<p><strong>Pooling strategies</strong>: $\sigma^i_k(\xi_k^i) = 1$ or $\sigma^i_k(\xi_k^i) = 0$ (vote constantly).</p>
<p>For truth-telling strategy, the equilibrium condition reduces to the incentive compatibility constraint:
$$\mathbb{P}(\omega^i = 1) \geq \frac{c_1}{c_1 + c_2}.$$
That is to say, under the strategy, I calculate the success probability within one holon $i$, it has to be above certain threshold for this strategy to be ``okay&rsquo;&rsquo; as an equilibrium, but to calculate the success rate under a type prior, you have to consider other holons as well, this eventaully becomes a tangled &lsquo;&lsquo;chicken-egg&rsquo;&rsquo; problem.</p>
<h3 id="the-fixed-point-problem">The Fixed-Point Problem</h3>
<p>Most &lsquo;&lsquo;chicken-egg&rsquo;&rsquo; problem can be solved by fixed-point equations.
Under symmetric truth-telling strategies, all committees have the same success probability $q$. The number of external failures follows $\text{Binomial}(|I|-1, 1-q)$, leading to the fixed-point equation:</p>
<p>$$q = \sum_{z=0}^{|I|-1} \binom{|I|-1}{z} (1-q)^z q^{|I|-1-z} \cdot \mathbb{P}\left(\text{Binomial}(n,p) \geq \theta + \gamma z\right)$$</p>
<p>For large $n \to \infty$, using the normal approximation:
$$q = \sum_{z=0}^{|I|-1} \binom{|I|-1}{z} (1-q)^z q^{|I|-1-z} \cdot \Phi\left(\frac{np - \theta - \gamma z}{\sqrt{np(1-p)}}\right)$$</p>
<p>In the limit $|I| \rightarrow \infty$ with $\delta = \gamma |I|$ fixed, this becomes:
$$q = \Phi\left(\frac{np - \theta - \delta(1-q)}{\sqrt{np(1-p)}}\right)$$</p>
<h3 id="existence-and-uniqueness-of-equilibria">Existence and Uniqueness of Equilibria</h3>
<p>Since there is no other way around than enumerating if every possible strategy satisfies the incentive compatibility, the key mathematical questions become:</p>
<ol>
<li><strong>Existence</strong>: When does a solution $q^* \in [0,1]$ exist?</li>
<li><strong>Uniqueness</strong>: When is the solution unique?</li>
<li><strong>Stability</strong>: When are equilibria robust to perturbations?</li>
</ol>
<p><strong>Uniqueness condition</strong>: The mapping $T(q) = \Phi\left(\frac{np - \theta - \delta(1-q)}{\sqrt{np(1-p)}}\right)$ is a contraction when:
$$\frac{\delta \phi\left(\frac{np - \theta - \delta(1-q)}{\sqrt{np(1-p)}}\right)}{\sqrt{np(1-p)}} &lt; 1$$</p>
<p>where $\phi$ is the standard normal density. This is guaranteed when $\delta$ is sufficiently small relative to $\sqrt{np(1-p)}$.</p>
<p><strong>Multiple equilibria</strong>: For large $\delta$, the system can exhibit bistability with equilibria near $q = 0$ and $q = 1$, separated by an unstable interior equilibrium. So the interpretation is, the more coupling between holons, the more chaotic it becomes. Below is kind of a relationship between $q$ and the prior $p$, the theoretical plot got twisted because at some of the $p$ the fixed point equations can&rsquo;t be solved.</p>
<p><img src="/images/post/2025/mechanism_design/success_holon.png" alt=""></p>
<p>With a simple set up like this it&rsquo;s already not very computationally convenient for seeking the equilibrium, so you can imagine how hard it is for general Bayesian Nash equilibrium.</p>
<p>The motivation of coming up with a system like this is still something I couldn&rsquo;t figure out, because what do I know.
But we should call it what it is. LOL.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Morris, Stephen, and Hyun Song Shin. &ldquo;Global games: Theory and applications.&rdquo; (2001).&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

        </div>
    </div>
    <a href="#" id="scrollToTopButton">
        <svg t="1686753152588" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="3988" width="48" height="48">
            <path
                d="M518.5 360.3c-3.2-4.4-9.7-4.4-12.9 0l-178 246c-3.8 5.3 0 12.7 6.5 12.7H381c10.2 0 19.9-4.9 25.9-13.2L512 460.4l105.2 145.4c6 8.3 15.6 13.2 25.9 13.2H690c6.5 0 10.3-7.4 6.5-12.7l-178-246z"
                p-id="3989" fill="#363636"></path>
            <path
                d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"
                p-id="3990" fill="#363636"></path>
        </svg>
    </a><hr style="border-top: 1px solid #EEEEEE;">
<div id="comment"></div>
<script>
    const getStoredTheme = () => localStorage.getItem("theme") === "dark" ? "dark" : "light";

    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "UnionPan\/UnionPan.github.io",
            "data-repo-id": "R_kgDOIZ-Mxw",
            "data-category": "General",
            "data-category-id": "DIC_kwDOIZ-Mx84CuT-c",
            "data-mapping": "pathname",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "en",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
            ([key, value]) => giscusScript.setAttribute(key, value));
        document.getElementById("comment").appendChild(giscusScript);

        
        const themeToggle = document.querySelector(".theme-toggle");
        if (themeToggle) {
            themeToggle.addEventListener("click", setGiscusTheme);
        }
    });

</script>


<div class="pp-container">
        <section class="pre-and-post">
            <div class="has-text-left">
                
            </div>
            <div class="has-text-right">
                
                <p>Next post</p>
                <a href="https://unionpan.github.io/post/2025/rlhf/">Reinforcement Learning with Human Feedback</a>
                
            </div>
        </section>
    </div>

</div>

                <footer class="footer">
</footer>
            </main>
        </div>

        <script>
            
            function setTheme(theme) {
                let body = document.body;
                let themeIcon = document.querySelector(".theme-icon");
                if (theme === "dark") {
                    body.classList.add("dark-mode");
                    themeIcon.src = "https:\/\/unionpan.github.io\/svg/moon.svg";
                    themeIcon.alt = "moon icon";
                } else {
                    body.classList.remove("dark-mode");
                    themeIcon.src = "https:\/\/unionpan.github.io\/svg/sun.svg";
                    themeIcon.alt = "sun icon";
                }
                localStorage.setItem("theme", theme);
            }

            
            document.addEventListener('DOMContentLoaded', function() {
                
                let theme = localStorage.getItem("theme");
                
                
                if (!theme) {
                    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                    theme = isDarkMode ? 'dark' : 'light';
                }
                
                setTheme(theme);

                
                document.getElementById("theme-toggle").addEventListener("click", function(e) {
                    e.preventDefault();
                    let currentTheme = localStorage.getItem("theme") || "light";
                    let newTheme = currentTheme === "light" ? "dark" : "light";
                    setTheme(newTheme);
                });
            });
            
            
            document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                const button = this;
                
                sidebar.classList.toggle('open');
                button.classList.toggle('active');
            });

            
            function toggleBlogMenu(event) {
                event.preventDefault();
                event.stopPropagation(); 
                const submenu = document.getElementById('blog-submenu');
                const arrow = document.querySelector('.dropdown-arrow');
                
                if (submenu.classList.contains('open')) {
                    submenu.classList.remove('open');
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    submenu.classList.add('open');
                    arrow.style.transform = 'rotate(180deg)';
                }
            }
            
            
            document.addEventListener('click', function(event) {
                const navContainer = document.querySelector('.nav-item-container');
                const submenu = document.getElementById('blog-submenu');
                const arrow = document.querySelector('.dropdown-arrow');
                
                if (!navContainer.contains(event.target) && submenu.classList.contains('open')) {
                    submenu.classList.remove('open');
                    arrow.style.transform = 'rotate(0deg)';
                }
            });

            
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const toggleButton = document.getElementById('mobile-menu-toggle');
                
                if (sidebar.classList.contains('open') && 
                    !sidebar.contains(event.target) && 
                    !toggleButton.contains(event.target)) {
                    sidebar.classList.remove('open');
                    toggleButton.classList.remove('active');
                }
            });

            
            document.querySelectorAll('.sidebar .nav-link, .sidebar .submenu-link').forEach(link => {
                if (!link.classList.contains('blog-toggle')) {
                    link.addEventListener('click', function() {
                        const sidebar = document.getElementById('sidebar');
                        const toggleButton = document.getElementById('mobile-menu-toggle');
                        sidebar.classList.remove('open');
                        toggleButton.classList.remove('active');
                    });
                }
            });
        </script>
    </body>
</html>

